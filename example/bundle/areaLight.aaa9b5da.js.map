{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,S,qHAWA,IAAIC,EAAUC,EAAUC,EAAmBC,EAAwBC,EAAYC,EAAWC,EAAYC,EAAQC,EAAQC,EAClHC,EAAWC,EACf,MAAMC,EAAS,CAEdC,UAAU,EAEVC,mBAAmB,EACnBC,sBAAsB,EACtBC,oBAAqB,EACrBC,gBAAiB,UACjBC,gBAAiB,EACjBC,iBAAkB,EAElBC,mBAAmB,EACnBC,sBAAsB,EACtBC,oBAAqB,GACrBC,gBAAiB,UACjBC,gBAAiB,KACjBC,iBAAkB,KAElBC,qBAAsB,IACtBC,oBAAqB,EAErBC,QAAS,EACTC,gBAAiB,EACjBC,gBAAiB,EAAIC,OAAOC,iBAC5BC,mBAAoB,GACpBC,MAAO,EACPC,4BAA4B,GAwQ7B,SAASC,IAERhC,EAAY,GAAIiC,WAAazB,EAAOG,qBACpCX,EAAY,GAAIkC,UAAY1B,EAAOI,oBACnCZ,EAAY,GAAImC,MAAQ3B,EAAOM,gBAC/Bd,EAAY,GAAIoC,OAAS5B,EAAOO,iBAChCf,EAAY,GAAIqC,MAAMC,IAAK9B,EAAOK,iBAAkB0B,sBAEpDvC,EAAY,GAAIiC,WAAazB,EAAOS,qBACpCjB,EAAY,GAAIkC,UAAY1B,EAAOU,oBACnClB,EAAY,GAAImC,MAAQ3B,EAAOY,gBAC/BpB,EAAY,GAAIoC,OAAS5B,EAAOa,iBAChCrB,EAAY,GAAIqC,MAAMC,IAAK9B,EAAOW,iBAAkBoB,sBAEpDlC,EAAgB,GACXG,EAAOE,mBAAoBL,EAAcmC,KAAMxC,EAAY,IAC3DQ,EAAOQ,mBAAoBX,EAAcmC,KAAMxC,EAAY,IAEhEE,EAAWuC,SAASC,OAAOC,WAAYtC,GACvCH,EAAW0C,O,CAIZ,SAASC,IAER,MAAMC,EAAInB,OAAOoB,WACXC,EAAIrB,OAAOsB,YACXC,EAAQ1C,EAAOkB,gBACfyB,EAAMxB,OAAOC,iBAEnB1B,EAAWkD,QAASN,EAAII,EAAQC,EAAKH,EAAIE,EAAQC,GACjDjD,EAAW0C,QAEXhD,EAASwD,QAASN,EAAGE,GACrBpD,EAASyD,cAAe1B,OAAOC,iBAAmBsB,GAClD/C,EAAOmD,OAASR,EAAIE,EACpB7C,EAAOoD,wB,CAIR,SAASC,IAERC,sBAAuBD,GAEvBtD,EAAWuC,SAASiB,UAAUf,WAAY1C,EAAUyD,UAAWzD,EAAU0D,UACzEzD,EAAWuC,SAASC,OAAOC,WAAYtC,GAEvCH,EAAWuC,SAASZ,mBAAqBrB,EAAOqB,mBAChD3B,EAAWuC,SAASnB,qBAAuBd,EAAOc,qBAClDpB,EAAWuC,SAASmB,gBAAkB,IACtC1D,EAAWuC,SAASjB,QAAUhB,EAAOgB,QAErCrB,EAAO0D,oBAEP,IAAM,IAAIC,EAAI,EAAGC,EAAIvD,EAAOiB,gBAAiBqC,EAAIC,EAAGD,IAEnD5D,EAAW8D,SAIZpE,EAASqE,WAAY,EACrB7D,EAAO8D,OAAQtE,GACfA,EAASsE,OAAQnE,EAAwBI,GACzCP,EAASqE,WAAY,EAErB3D,EAAU6D,UAAY,YAAaC,KAAKC,MAAOnE,EAAWoE,U,CApUvC3C,OAAOoB,WAAapB,OAAOsB,YAC5B,MAElBzC,EAAOgB,QAAU4C,KAAKG,IAAK/D,EAAOgB,QAAS,IAC3ChB,EAAOkB,iBAAmB,GAC1BlB,EAAOsB,MAAQ,GAchB0C,iBAEC5E,EAAW,IAAIF,EAAA+E,cAAqB,CAAEC,WAAW,IACjD9E,EAAS+E,eAAiBjF,EAAAkF,aAC1BhF,EAASiF,YAAcnF,EAAAoF,sBACvBC,SAASC,KAAKC,YAAarF,EAASsF,YAEpC/E,EAAS,IAAIT,EAAAyF,kBAAyB,GAAIxD,OAAOoB,WAAapB,OAAOsB,YAAa,KAAO,KACzF9C,EAAOiF,SAAS9C,IAAK,EAAK,GAAK,MAE/BpC,EAAa,IAAImF,EAAAC,oBAAqB1F,GACtCM,EAAWqF,OAASpF,EACpBD,EAAWuC,SAAW,IAAI4C,EAAAG,4BAC1BtF,EAAW4B,MAAMQ,IAAK9B,EAAOsB,MAAOtB,EAAOsB,OAE3C1B,EAAS,IAAIqF,EAAAC,eAAgB,IAAIhG,EAAAiG,kBAAyB,CACzDC,IAAK1F,EAAW2F,OAAOC,WAGxBjG,EAAW,IAAIkG,EAAAC,cAAe7F,EAAQP,EAASsF,YAC/CrF,EAASgG,OAAOvD,IAAK,EAAG,KAAM,KAC9BnC,EAAO8F,OAAQpG,EAASgG,QACxBhG,EAASqG,iBAAkB,UAAU,KAEpChG,EAAW0C,OAAO,IAGnB/C,EAASmE,SAET7D,EAAO8F,QAAQ,IAAQ,KAAM,KAE7B3F,EAAYyE,SAASoB,eAAgB,WACrC5F,EAAYwE,SAASoB,eAAgB,WAErC,MAAMC,GAAgB,IAAIC,EAAAC,YAAaC,YAAa7G,EAAA8G,WAClDC,UAAW,iGACXC,MAAMZ,IAEN5F,EAAWuC,SAASkE,WAAWhE,WAAYmD,EAAS,IAIhDc,EAAQ,IAAIlH,EAAAmH,MAEZC,EAAM,IAAIpH,EAAAqH,MA3GjBC,MA4GSA,SAAgB,IAAIC,EAAAC,YAC1BC,kBAAmBC,EAAAC,gBACnBZ,UAAW,8GAEbO,EAAMM,UAAUC,IAEVA,EAAE9E,WAAW8E,EAAE9E,SAASmD,IAAM,KAAI,IAIxCoB,EAAM9D,MAAMsE,UAAW,KAEvBR,EAAM5B,SAASqC,EAAI,IACnBT,EAAMnD,mBAAmB,GAEzBiD,EAAIY,cAAeV,GACnBA,EAAM5B,SAASuC,GAAKb,EAAIvC,IAAIoD,EAE5Bf,EAAMgB,IAAKZ,GAEX,MAAMa,EAAY,IAAInI,EAAAoI,iBAAwB,IAAK,IAAK,IAAM,IACxDC,EAAW,IAAIrI,EAAAsI,qBAA4B,CAAE3F,MAAO,IAAI3C,EAAAuI,MAAa,UAAYC,UAAW,GAAKC,UAAW,MAC5G9D,EAAQ,IAAI3E,EAAA0I,KAAYP,EAAWE,GACzC1D,EAAMe,SAASuC,GAAI,KACnBf,EAAMgB,IAAKvD,GAQXuC,EAAM/C,oBAEN,MAAMwE,EAAa,IAAIhD,EAAAiD,gBAAiB,IAAI5I,EAAAuI,MAAa,UAAY,EAAK,EAAK,GAC/EI,EAAWjD,SAASqC,EAAI,IACxBY,EAAWjD,SAASuC,EAAI,EACxBU,EAAWjD,SAASmD,GAAI,GACxBF,EAAWG,SAAWpE,KAAKqE,GAAK,GAChCJ,EAAWK,SAAWtE,KAAKqE,GAAK,GAChCJ,EAAWpG,YAAa,EACxB2E,EAAMgB,IAAKS,GAEX,MAAMM,EAAa,IAAItD,EAAAiD,gBAAiB,IAAI5I,EAAAuI,MAAa,UAAY,GAAM,KAAM,MACjFU,EAAWvD,SAASuC,EAAI,KACxBgB,EAAWvD,SAASmD,GAAI,IACxBI,EAAWD,QAAStE,KAAKqE,IACzBE,EAAW1G,YAAa,EACxB2E,EAAMgB,IAAKe,GAEX3I,EAAa,CAAEqI,EAAYM,GAE3B7I,EAAoB,IAAI8I,EAAAC,kBAAmB1I,EAAQP,EAASsF,YAC5DpF,EAAkBoG,iBAAkB,gBAAgB,KAEnDhG,EAAWuC,SAASC,OAAOC,WAAY3C,GACvCE,EAAW0C,OAAO,IAGnB9C,EAAkBoG,iBAAkB,oBAAsB4C,GAAOjJ,EAASkJ,SAAYD,EAAEE,QACxFlJ,EAAkBmJ,OAAQZ,GAC1BvI,EAAkBsD,QAAS,IAE3BzB,OAAOuE,iBAAkB,WAAW,SAAWgD,GAE9C,OAASA,EAAMC,KAEf,IAAK,IACJrJ,EAAkBsJ,QAAS,aAC3B,MAED,IAAK,IACJtJ,EAAkBsJ,QAAS,U,IAO7BrJ,EAAyB,IAAIL,EAAA2J,MAC7BtJ,EAAuB6H,IAAK9H,GAE5B,MAAMwJ,EAAY,IAAIC,EAAAC,uBAChBC,EAAmBH,EAAUI,SAAU9C,EAAO,CACnD+C,WAAYC,GAEXrJ,EAAU4D,UAAY,kBAAmBC,KAAKyF,MAAO,IAAMD,K,IAGzDlD,MAAMoD,IAET7J,EAAY6J,EAEZ,MAzMFC,IAyMUA,EAzMVpG,SAyMeA,EAzMfD,UAyMyBA,EAzMzBhB,OAyMoCA,GAAWoH,EACvCE,EAAWD,EAAIC,SACfvH,EAAWvC,EAAWuC,SAE5BA,EAASsH,IAAIpH,WAAYoH,GACzBtH,EAASwH,gBAAgBtH,WACxBqH,EAASE,WAAWC,OACpBH,EAASE,WAAWE,QACpBJ,EAASE,WAAWG,GACpBL,EAASE,WAAW7H,OAErBI,EAAS6H,uBAAuB3H,WAAYqH,EAASE,WAAWK,eAChE9H,EAASkB,SAAS6G,YAAa5K,EAAU,KAAM,KAAM+D,GACrDlB,EAASiB,UAAUf,WAAYe,EAAWC,GAC1ClB,EAASC,OAAOC,WAAYD,GAC5BD,EAASgI,WAAa/H,EAAOgI,OAE7BpB,EAAUqB,SAAS,UAIdC,QAAQC,IAAK,CAAEpB,EAAkBrD,IAEvCrB,SAASoB,eAAgB,WAAY2E,SAErCjI,IACAlB,OAAOuE,iBAAkB,SAAUrD,GAEnC,MAAMkI,EAAM,IAAIC,EAAAC,IAChBF,EAAInD,IAAKpH,EAAQ,YAAa0K,UAAUtB,IAEvC9J,EAAkBiJ,QAAUa,EAC5B9J,EAAkBqL,QAAUvB,CAAC,IAG9B,MAAMwB,EAAWL,EAAIM,UAAW,gBAChCD,EAASxD,IAAKpH,EAAQ,QAAS,EAAG,EAAG,GAAI0K,UAAUlC,IAElD9I,EAAW4B,MAAMQ,IAAK0G,EAAOA,EAAO,IAGrCoC,EAASxD,IAAKpH,EAAQ,kBAAmB,EAAG,GAAI,GAChD4K,EAASxD,IAAKpH,EAAQ,qBAAsB,EAAG,GAAI0K,UAAU,KAE5DhL,EAAW0C,OAAO,IAGnBwI,EAASxD,IAAKpH,EAAQ,UAAW,EAAG,GAAI,GAAI0K,UAAU,KAErDhL,EAAW0C,OAAO,IAGnBwI,EAASxD,IAAKpH,EAAQ,kBAAmB,GAAK,GAAI0K,UAAU,KAE3DrI,GAAU,IAGXuI,EAASxD,IAAKpH,EAAQ,8BAA+B0K,UAAU,KAE9DhL,EAAWuC,SAAS6I,QAAQC,YAAc/K,EAAOuB,2BAA6B,EAAI,EAClF7B,EAAWuC,SAAS+I,aAAc,EAClCtL,EAAW0C,OAAO,IAGnBwI,EAASK,QAET,MAAMC,EAAYX,EAAIM,UAAW,eACjCK,EAAU9D,IAAKpH,EAAQ,uBAAwB,EAAG,GAAI0K,UAAU,KAE/DhL,EAAW0C,OAAO,IAGnB8I,EAAU9D,IAAKpH,EAAQ,sBAAuB,EAAG,EAAI4D,KAAKqE,IAAKyC,UAAUtB,IAExE1J,EAAWuC,SAASlB,oBAAoBoK,cAAe/B,GACvD1J,EAAW0C,OAAO,IAGnB8I,EAAUD,QAEV,MAAMG,EAAmBb,EAAIM,UAAW,gBACxCO,EAAiBhE,IAAKpH,EAAQ,qBAAsBqL,KAAM,UAAWX,SAAUlJ,GAC/E4J,EAAiBhE,IAAKpH,EAAQ,wBAAyBqL,KAAM,cAAeX,SAAUlJ,GACtF4J,EAAiBhE,IAAKpH,EAAQ,sBAAuB,EAAG,KAAMqL,KAAM,aAAcX,SAAUlJ,GAC5F4J,EAAiBE,SAAUtL,EAAQ,mBAAoBqL,KAAM,SAAUX,SAAUlJ,GACjF4J,EAAiBhE,IAAKpH,EAAQ,kBAAmB,EAAG,GAAIqL,KAAM,SAAUX,SAAUlJ,GAClF4J,EAAiBhE,IAAKpH,EAAQ,mBAAoB,EAAG,GAAIqL,KAAM,UAAWX,SAAUlJ,GAEpF,MAAM+J,EAAmBhB,EAAIM,UAAW,gBACxCU,EAAiBnE,IAAKpH,EAAQ,qBAAsBqL,KAAM,UAAWX,SAAUlJ,GAC/E+J,EAAiBnE,IAAKpH,EAAQ,wBAAyBqL,KAAM,cAAeX,SAAUlJ,GACtF+J,EAAiBnE,IAAKpH,EAAQ,sBAAuB,EAAG,KAAMqL,KAAM,aAAcX,SAAUlJ,GAC5F+J,EAAiBD,SAAUtL,EAAQ,mBAAoBqL,KAAM,SAAUX,SAAUlJ,GACjF+J,EAAiBnE,IAAKpH,EAAQ,kBAAmB,EAAG,GAAIqL,KAAM,SAAUX,SAAUlJ,GAClF+J,EAAiBnE,IAAKpH,EAAQ,mBAAoB,EAAG,GAAIqL,KAAM,UAAWX,SAAUlJ,GAEpFA,IAEAwB,G,CAtPDwI","sources":["example/areaLight.js"],"sourcesContent":["import * as THREE from 'three';\nimport { FullScreenQuad } from 'three/examples/jsm/postprocessing/Pass.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { PathTracingRenderer, PhysicalPathTracingMaterial, ShapedAreaLight } from '../src/index.js';\nimport { PathTracingSceneWorker } from '../src/workers/PathTracingSceneWorker.js';\nimport { RGBELoader } from 'three/examples/jsm/loaders/RGBELoader.js';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\nimport { TransformControls } from 'three/examples/jsm/controls/TransformControls.js';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport { MeshoptDecoder } from 'three/examples/jsm/libs/meshopt_decoder.module.js';\n\nlet renderer, controls, transformControls, transformControlsScene, areaLights, sceneInfo, ptRenderer, camera, fsQuad, enabledLights;\nlet samplesEl, loadingEl;\nconst params = {\n\n\tcontrols: true,\n\n\tareaLight1Enabled: true,\n\tareaLight1IsCircular: false,\n\tareaLight1Intensity: 2,\n\tareaLight1Color: '#ffffff',\n\tareaLight1Width: 1,\n\tareaLight1Height: 1,\n\n\tareaLight2Enabled: true,\n\tareaLight2IsCircular: false,\n\tareaLight2Intensity: 10,\n\tareaLight2Color: '#ff0000',\n\tareaLight2Width: 1.25,\n\tareaLight2Height: 2.75,\n\n\tenvironmentIntensity: 0.03,\n\tenvironmentRotation: 0,\n\n\tbounces: 5,\n\tsamplesPerFrame: 1,\n\tresolutionScale: 1 / window.devicePixelRatio,\n\tfilterGlossyFactor: 0.5,\n\ttiles: 1,\n\tmultipleImportanceSampling: true\n\n};\n\n// clamp value for mobile\nconst aspectRatio = window.innerWidth / window.innerHeight;\nif ( aspectRatio < 0.65 ) {\n\n\tparams.bounces = Math.min( params.bounces, 10 );\n\tparams.resolutionScale *= 0.5;\n\tparams.tiles = 3;\n\n}\n\ninit();\n\n// other sculptures\n// * https://sketchfab.com/3d-models/nile-42e02439c61049d681c897441d40aaa1\n// * https://sketchfab.com/3d-models/statue-of-bacchus-09f1c94f43e0400c8916149bab297918\n// https://sketchfab.com/3d-models/2-aliens-figure-a58af7bd939d46fca4eb46e43588944f\n// * https://sketchfab.com/3d-models/lowe-4afeca000f444619ad581a30aa4fd17e\n// * https://sketchfab.com/3d-models/laocoon-and-his-sons-649111a9a7b74ddab3937292be5545fc\n// * https://sketchfab.com/3d-models/mercury-about-to-kill-argos-by-b-thorvaldsen-bdcd0813bf54467fb879ee1681a3a6d3\n\nasync function init() {\n\n\trenderer = new THREE.WebGLRenderer( { antialias: true } );\n\trenderer.outputEncoding = THREE.sRGBEncoding;\n\trenderer.toneMapping = THREE.ACESFilmicToneMapping;\n\tdocument.body.appendChild( renderer.domElement );\n\n\tcamera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.025, 500 );\n\tcamera.position.set( 0.0, 0.6, 2.65 );\n\n\tptRenderer = new PathTracingRenderer( renderer );\n\tptRenderer.camera = camera;\n\tptRenderer.material = new PhysicalPathTracingMaterial();\n\tptRenderer.tiles.set( params.tiles, params.tiles );\n\n\tfsQuad = new FullScreenQuad( new THREE.MeshBasicMaterial( {\n\t\tmap: ptRenderer.target.texture,\n\t} ) );\n\n\tcontrols = new OrbitControls( camera, renderer.domElement );\n\tcontrols.target.set( 0, 0.33, - 0.08 );\n\tcamera.lookAt( controls.target );\n\tcontrols.addEventListener( 'change', () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\tcontrols.update();\n\n\tcamera.lookAt( - 0.15, 0.33, - 0.08 );\n\n\tsamplesEl = document.getElementById( 'samples' );\n\tloadingEl = document.getElementById( 'loading' );\n\n\tconst envMapPromise = new RGBELoader().setDataType( THREE.FloatType )\n\t\t.loadAsync( 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/leadenhall_market_1k.hdr' )\n\t\t.then( texture => {\n\n\t\t\tptRenderer.material.envMapInfo.updateFrom( texture );\n\n\t\t} );\n\n\tconst group = new THREE.Group();\n\n\tconst box = new THREE.Box3();\n\tconst { scene } = await new GLTFLoader()\n\t\t.setMeshoptDecoder( MeshoptDecoder )\n\t\t.loadAsync( 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/mercury-about-to-kill-argos/scene.glb' );\n\n\tscene.traverse( c => {\n\n\t\tif ( c.material ) c.material.map = null;\n\n\t} );\n\n\tscene.scale.setScalar( 0.01 );\n\t// scene.rotation.x = - Math.PI / 2;\n\tscene.position.x = 0.05;\n\tscene.updateMatrixWorld( true );\n\n\tbox.setFromObject( scene );\n\tscene.position.y -= box.min.y;\n\n\tgroup.add( scene );\n\n\tconst floorGeom = new THREE.CylinderGeometry( 3.5, 3.5, 0.05, 60 );\n\tconst floorMat = new THREE.MeshPhysicalMaterial( { color: new THREE.Color( 0x999999 ), metalness: 0.2, roughness: 0.02 } );\n\tconst floor = new THREE.Mesh( floorGeom, floorMat );\n\tfloor.position.y = - 0.025;\n\tgroup.add( floor );\n\n\t// const redBoxGeom = new THREE.BoxBufferGeometry( 0.1, 2, 2 );\n\t// const redBoxMat = new THREE.MeshPhysicalMaterial( { color: new THREE.Color( 0xFF0000 ) } );\n\t// const redBox = new THREE.Mesh( redBoxGeom, redBoxMat );\n\t// redBox.position.set( - 1.5, 1.0, 0.0 );\n\t// // group.add( redBox );\n\n\tgroup.updateMatrixWorld();\n\n\tconst areaLight1 = new ShapedAreaLight( new THREE.Color( 0xFFFFFF ), 5.0, 1.0, 1.0 );\n\tareaLight1.position.x = 1.5;\n\tareaLight1.position.y = 1.0;\n\tareaLight1.position.z = - 0.5;\n\tareaLight1.rotateZ( - Math.PI / 4 );\n\tareaLight1.rotateX( - Math.PI / 2 );\n\tareaLight1.isCircular = false;\n\tgroup.add( areaLight1 );\n\n\tconst areaLight2 = new ShapedAreaLight( new THREE.Color( 0xFF0000 ), 15.0, 1.25, 2.75 );\n\tareaLight2.position.y = 1.25;\n\tareaLight2.position.z = - 1.5;\n\tareaLight2.rotateX( Math.PI );\n\tareaLight2.isCircular = false;\n\tgroup.add( areaLight2 );\n\n\tareaLights = [ areaLight1, areaLight2 ];\n\n\ttransformControls = new TransformControls( camera, renderer.domElement );\n\ttransformControls.addEventListener( 'objectChange', () => {\n\n\t\tptRenderer.material.lights.updateFrom( areaLights );\n\t\tptRenderer.reset();\n\n\t} );\n\ttransformControls.addEventListener( 'dragging-changed', ( e ) => controls.enabled = ! e.value );\n\ttransformControls.attach( areaLight1 );\n\ttransformControls.setSize( 0.5 );\n\n\twindow.addEventListener( 'keydown', function ( event ) {\n\n\t\tswitch ( event.key ) {\n\n\t\tcase 'w':\n\t\t\ttransformControls.setMode( 'translate' );\n\t\t\tbreak;\n\n\t\tcase 'e':\n\t\t\ttransformControls.setMode( 'rotate' );\n\t\t\tbreak;\n\n\t\t}\n\n\t} );\n\n\ttransformControlsScene = new THREE.Scene();\n\ttransformControlsScene.add( transformControls );\n\n\tconst generator = new PathTracingSceneWorker();\n\tconst generatorPromise = generator.generate( group, {\n\t\tonProgress( v ) {\n\n\t\t\tloadingEl.innerText = `Generating BVH ${ Math.round( 100 * v ) }%`;\n\n\t\t}\n\t} ).then( result => {\n\n\t\tsceneInfo = result;\n\n\t\tconst { bvh, textures, materials, lights } = result;\n\t\tconst geometry = bvh.geometry;\n\t\tconst material = ptRenderer.material;\n\n\t\tmaterial.bvh.updateFrom( bvh );\n\t\tmaterial.attributesArray.updateFrom(\n\t\t\tgeometry.attributes.normal,\n\t\t\tgeometry.attributes.tangent,\n\t\t\tgeometry.attributes.uv,\n\t\t\tgeometry.attributes.color,\n\t\t);\n\t\tmaterial.materialIndexAttribute.updateFrom( geometry.attributes.materialIndex );\n\t\tmaterial.textures.setTextures( renderer, 2048, 2048, textures );\n\t\tmaterial.materials.updateFrom( materials, textures );\n\t\tmaterial.lights.updateFrom( lights );\n\t\tmaterial.lightCount = lights.length;\n\n\t\tgenerator.dispose();\n\n\t} );\n\n\tawait Promise.all( [ generatorPromise, envMapPromise ] );\n\n\tdocument.getElementById( 'loading' ).remove();\n\n\tonResize();\n\twindow.addEventListener( 'resize', onResize );\n\n\tconst gui = new GUI();\n\tgui.add( params, 'controls' ).onChange( v => {\n\n\t\ttransformControls.enabled = v;\n\t\ttransformControls.visible = v;\n\n\t} );\n\tconst ptFolder = gui.addFolder( 'Path Tracing' );\n\tptFolder.add( params, 'tiles', 1, 4, 1 ).onChange( value => {\n\n\t\tptRenderer.tiles.set( value, value );\n\n\t} );\n\tptFolder.add( params, 'samplesPerFrame', 1, 10, 1 );\n\tptFolder.add( params, 'filterGlossyFactor', 0, 1 ).onChange( () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\tptFolder.add( params, 'bounces', 1, 15, 1 ).onChange( () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\tptFolder.add( params, 'resolutionScale', 0.1, 1 ).onChange( () => {\n\n\t\tonResize();\n\n\t} );\n\tptFolder.add( params, 'multipleImportanceSampling' ).onChange( () => {\n\n\t\tptRenderer.material.defines.FEATURE_MIS = params.multipleImportanceSampling ? 1 : 0;\n\t\tptRenderer.material.needsUpdate = true;\n\t\tptRenderer.reset();\n\n\t} );\n\tptFolder.close();\n\n\tconst envFolder = gui.addFolder( 'Environment' );\n\tenvFolder.add( params, 'environmentIntensity', 0, 3 ).onChange( () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\tenvFolder.add( params, 'environmentRotation', 0, 2 * Math.PI ).onChange( v => {\n\n\t\tptRenderer.material.environmentRotation.makeRotationY( v );\n\t\tptRenderer.reset();\n\n\t} );\n\tenvFolder.close();\n\n\tconst areaLight1Folder = gui.addFolder( 'Area Light 1' );\n\tareaLight1Folder.add( params, 'areaLight1Enabled' ).name( 'enable' ).onChange( updateLights );\n\tareaLight1Folder.add( params, 'areaLight1IsCircular' ).name( 'isCircular' ).onChange( updateLights );\n\tareaLight1Folder.add( params, 'areaLight1Intensity', 0, 200 ).name( 'intensity' ).onChange( updateLights );\n\tareaLight1Folder.addColor( params, 'areaLight1Color' ).name( 'color' ).onChange( updateLights );\n\tareaLight1Folder.add( params, 'areaLight1Width', 0, 5 ).name( 'width' ).onChange( updateLights );\n\tareaLight1Folder.add( params, 'areaLight1Height', 0, 5 ).name( 'height' ).onChange( updateLights );\n\n\tconst areaLight2Folder = gui.addFolder( 'Area Light 2' );\n\tareaLight2Folder.add( params, 'areaLight2Enabled' ).name( 'enable' ).onChange( updateLights );\n\tareaLight2Folder.add( params, 'areaLight2IsCircular' ).name( 'isCircular' ).onChange( updateLights );\n\tareaLight2Folder.add( params, 'areaLight2Intensity', 0, 200 ).name( 'intensity' ).onChange( updateLights );\n\tareaLight2Folder.addColor( params, 'areaLight2Color' ).name( 'color' ).onChange( updateLights );\n\tareaLight2Folder.add( params, 'areaLight2Width', 0, 5 ).name( 'width' ).onChange( updateLights );\n\tareaLight2Folder.add( params, 'areaLight2Height', 0, 5 ).name( 'height' ).onChange( updateLights );\n\n\tupdateLights();\n\n\tanimate();\n\n}\n\nfunction updateLights() {\n\n\tareaLights[ 0 ].isCircular = params.areaLight1IsCircular;\n\tareaLights[ 0 ].intensity = params.areaLight1Intensity;\n\tareaLights[ 0 ].width = params.areaLight1Width;\n\tareaLights[ 0 ].height = params.areaLight1Height;\n\tareaLights[ 0 ].color.set( params.areaLight1Color ).convertSRGBToLinear();\n\n\tareaLights[ 1 ].isCircular = params.areaLight2IsCircular;\n\tareaLights[ 1 ].intensity = params.areaLight2Intensity;\n\tareaLights[ 1 ].width = params.areaLight2Width;\n\tareaLights[ 1 ].height = params.areaLight2Height;\n\tareaLights[ 1 ].color.set( params.areaLight2Color ).convertSRGBToLinear();\n\n\tenabledLights = [];\n\tif ( params.areaLight1Enabled ) enabledLights.push( areaLights[ 0 ] );\n\tif ( params.areaLight2Enabled ) enabledLights.push( areaLights[ 1 ] );\n\n\tptRenderer.material.lights.updateFrom( enabledLights );\n\tptRenderer.reset();\n\n}\n\nfunction onResize() {\n\n\tconst w = window.innerWidth;\n\tconst h = window.innerHeight;\n\tconst scale = params.resolutionScale;\n\tconst dpr = window.devicePixelRatio;\n\n\tptRenderer.setSize( w * scale * dpr, h * scale * dpr );\n\tptRenderer.reset();\n\n\trenderer.setSize( w, h );\n\trenderer.setPixelRatio( window.devicePixelRatio * scale );\n\tcamera.aspect = w / h;\n\tcamera.updateProjectionMatrix();\n\n}\n\nfunction animate() {\n\n\trequestAnimationFrame( animate );\n\n\tptRenderer.material.materials.updateFrom( sceneInfo.materials, sceneInfo.textures );\n\tptRenderer.material.lights.updateFrom( enabledLights );\n\n\tptRenderer.material.filterGlossyFactor = params.filterGlossyFactor;\n\tptRenderer.material.environmentIntensity = params.environmentIntensity;\n\tptRenderer.material.environmentBlur = 0.35;\n\tptRenderer.material.bounces = params.bounces;\n\n\tcamera.updateMatrixWorld();\n\n\tfor ( let i = 0, l = params.samplesPerFrame; i < l; i ++ ) {\n\n\t\tptRenderer.update();\n\n\t}\n\n\trenderer.autoClear = false;\n\tfsQuad.render( renderer );\n\trenderer.render( transformControlsScene, camera );\n\trenderer.autoClear = true;\n\n\tsamplesEl.innerText = `Samples: ${ Math.floor( ptRenderer.samples ) }`;\n\n}\n"],"names":["$ilwiq","parcelRequire","$840382748b150f6e$var$renderer","$840382748b150f6e$var$controls","$840382748b150f6e$var$transformControls","$840382748b150f6e$var$transformControlsScene","$840382748b150f6e$var$areaLights","$840382748b150f6e$var$sceneInfo","$840382748b150f6e$var$ptRenderer","$840382748b150f6e$var$camera","$840382748b150f6e$var$fsQuad","$840382748b150f6e$var$enabledLights","$840382748b150f6e$var$samplesEl","$840382748b150f6e$var$loadingEl","$840382748b150f6e$var$params","controls","areaLight1Enabled","areaLight1IsCircular","areaLight1Intensity","areaLight1Color","areaLight1Width","areaLight1Height","areaLight2Enabled","areaLight2IsCircular","areaLight2Intensity","areaLight2Color","areaLight2Width","areaLight2Height","environmentIntensity","environmentRotation","bounces","samplesPerFrame","resolutionScale","window","devicePixelRatio","filterGlossyFactor","tiles","multipleImportanceSampling","$840382748b150f6e$var$updateLights","isCircular","intensity","width","height","color","set","convertSRGBToLinear","push","material","lights","updateFrom","reset","$840382748b150f6e$var$onResize","w","innerWidth","h","innerHeight","scale","dpr","setSize","setPixelRatio","aspect","updateProjectionMatrix","$840382748b150f6e$var$animate","requestAnimationFrame","materials","textures","environmentBlur","updateMatrixWorld","i","l","update","autoClear","render","innerText","Math","floor","samples","min","async","WebGLRenderer","antialias","outputEncoding","sRGBEncoding","toneMapping","ACESFilmicToneMapping","document","body","appendChild","domElement","PerspectiveCamera","position","$4CEV9","PathTracingRenderer","camera","PhysicalPathTracingMaterial","$RPVlj","FullScreenQuad","MeshBasicMaterial","map","target","texture","$5Rd1x","OrbitControls","lookAt","addEventListener","getElementById","envMapPromise","$891vQ","RGBELoader","setDataType","FloatType","loadAsync","then","envMapInfo","group","Group","box","Box3","scene","$7lx9d","GLTFLoader","setMeshoptDecoder","$kp7Te","MeshoptDecoder","traverse","c","setScalar","x","setFromObject","y","add","floorGeom","CylinderGeometry","floorMat","MeshPhysicalMaterial","Color","metalness","roughness","Mesh","areaLight1","ShapedAreaLight","z","rotateZ","PI","rotateX","areaLight2","$fUhpq","TransformControls","e","enabled","value","attach","event","key","setMode","Scene","generator","$cVdfP","PathTracingSceneWorker","generatorPromise","generate","onProgress","v","round","result","bvh","geometry","attributesArray","attributes","normal","tangent","uv","materialIndexAttribute","materialIndex","setTextures","lightCount","length","dispose","Promise","all","remove","gui","$jiuw3","GUI","onChange","visible","ptFolder","addFolder","defines","FEATURE_MIS","needsUpdate","close","envFolder","makeRotationY","areaLight1Folder","name","addColor","areaLight2Folder","$840382748b150f6e$var$init"],"version":3,"file":"areaLight.aaa9b5da.js.map"}