{"mappings":"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","sources":["example/basic.js"],"sourcesContent":["import * as THREE from 'three';\nimport { FullScreenQuad } from 'three/examples/jsm/postprocessing/Pass.js';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { PathTracingRenderer, PhysicalPathTracingMaterial, PhysicalCamera } from '../src/index.js';\nimport { PathTracingSceneWorker } from '../src/workers/PathTracingSceneWorker.js';\nimport { RGBELoader } from 'three/examples/jsm/loaders/RGBELoader.js';\n\nlet renderer, controls, pathTracer, blitQuad, camera, scene, samplesEl;\n\nlet tiles = 2;\nlet resolutionScale = Math.max( 1 / window.devicePixelRatio, 0.5 );\n\n// adjust performance parameters for mobile\nconst aspectRatio = window.innerWidth / window.innerHeight;\nif ( aspectRatio < 0.65 ) {\n\n\tresolutionScale = 1 / window.devicePixelRatio;\n\ttiles = 3;\n\n}\n\ninit();\n\nasync function init() {\n\n\tsamplesEl = document.getElementById( 'samples' );\n\n\t// init renderer, camera, controls, scene\n\trenderer = new THREE.WebGLRenderer( { antialias: true } );\n\trenderer.toneMapping = THREE.ACESFilmicToneMapping;\n\trenderer.outputEncoding = THREE.sRGBEncoding;\n\trenderer.setClearColor( 0, 0 );\n\tdocument.body.appendChild( renderer.domElement );\n\n\tcamera = new PhysicalCamera( 75, 1, 0.025, 500 );\n\tcamera.position.set( 8, 9, 24 );\n\n\tcontrols = new OrbitControls( camera, renderer.domElement );\n\tcontrols.target.y = 10;\n\tcontrols.update();\n\n\tscene = new THREE.Scene();\n\tscene.backgroundBlurriness = 0.05;\n\n\t// init path tracer\n\tpathTracer = new PathTracingRenderer( renderer );\n\tpathTracer.material = new PhysicalPathTracingMaterial();\n\tpathTracer.material.filterGlossyFactor = 0.5;\n\tpathTracer.material.backgroundBlur = 0.05;\n\tpathTracer.tiles.set( tiles, tiles );\n\tpathTracer.camera = camera;\n\n\tblitQuad = new FullScreenQuad( new THREE.MeshBasicMaterial( {\n\t\tmap: pathTracer.target.texture,\n\t\tblending: THREE.CustomBlending,\n\t} ) );\n\n\tcontrols.addEventListener( 'change', () => {\n\n\t\tpathTracer.reset();\n\n\t} );\n\n\t// load the envmap and model\n\tconst envMapPromise = new RGBELoader().setDataType( THREE.FloatType )\n\t\t.loadAsync( 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/chinese_garden_1k.hdr' )\n\t\t.then( texture => {\n\n\t\t\ttexture.mapping = THREE.EquirectangularReflectionMapping;\n\t\t\tscene.background = texture;\n\t\t\tscene.environment = texture;\n\t\t\tpathTracer.material.envMapInfo.updateFrom( texture );\n\n\t\t} );\n\n\tconst generator = new PathTracingSceneWorker();\n\tconst gltfPromise = new GLTFLoader()\n\t\t.loadAsync( 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/terrarium-robots/scene.gltf' )\n\t\t.then( gltf => {\n\n\t\t\treturn generator.generate( gltf.scene );\n\n\t\t} )\n\t\t.then( result => {\n\n\t\t\tscene.add( result.scene );\n\n\t\t\tconst { bvh, textures, materials } = result;\n\t\t\tconst geometry = bvh.geometry;\n\t\t\tconst material = pathTracer.material;\n\n\t\t\tmaterial.bvh.updateFrom( bvh );\n\t\t\tmaterial.attributesArray.updateFrom(\n\t\t\t\tgeometry.attributes.normal,\n\t\t\t\tgeometry.attributes.tangent,\n\t\t\t\tgeometry.attributes.uv,\n\t\t\t\tgeometry.attributes.color,\n\t\t\t);\n\t\t\tmaterial.materialIndexAttribute.updateFrom( geometry.attributes.materialIndex );\n\t\t\tmaterial.textures.setTextures( renderer, 2048, 2048, textures );\n\t\t\tmaterial.materials.updateFrom( materials, textures );\n\n\t\t\tgenerator.dispose();\n\n\t\t} );\n\n\t// wait for the scene to be rady\n\tawait Promise.all( [ gltfPromise, envMapPromise ] );\n\n\tdocument.getElementById( 'loading' ).remove();\n\twindow.addEventListener( 'resize', onResize );\n\n\tonResize();\n\tanimate();\n\n}\n\nfunction onResize() {\n\n\t// update rendering resolution\n\tconst w = window.innerWidth;\n\tconst h = window.innerHeight;\n\tconst scale = resolutionScale;\n\tconst dpr = window.devicePixelRatio;\n\n\tpathTracer.setSize( w * scale * dpr, h * scale * dpr );\n\tpathTracer.reset();\n\n\trenderer.setSize( w, h );\n\trenderer.setPixelRatio( window.devicePixelRatio * scale );\n\n\tconst aspect = w / h;\n\tcamera.aspect = aspect;\n\tcamera.updateProjectionMatrix();\n\n}\n\nfunction animate() {\n\n\trequestAnimationFrame( animate );\n\n\tcamera.updateMatrixWorld();\n\tpathTracer.update();\n\n\tif ( pathTracer.samples < 1 ) {\n\n\t\trenderer.render( scene, camera );\n\n\t}\n\n\trenderer.autoClear = false;\n\tblitQuad.material.map = pathTracer.target.texture;\n\tblitQuad.render( renderer );\n\trenderer.autoClear = true;\n\n\tsamplesEl.innerText = `Samples: ${ Math.floor( pathTracer.samples ) }`;\n\n}\n"],"names":["$ilwiq","parcelRequire","$dfcb81d2867cd445$var$renderer","$dfcb81d2867cd445$var$controls","$dfcb81d2867cd445$var$pathTracer","$dfcb81d2867cd445$var$blitQuad","$dfcb81d2867cd445$var$camera","$dfcb81d2867cd445$var$scene","$dfcb81d2867cd445$var$samplesEl","$dfcb81d2867cd445$var$tiles","$dfcb81d2867cd445$var$resolutionScale","Math","max","window","devicePixelRatio","$dfcb81d2867cd445$var$onResize","w","innerWidth","h","innerHeight","scale","dpr","setSize","reset","setPixelRatio","aspect","updateProjectionMatrix","$dfcb81d2867cd445$var$animate","requestAnimationFrame","updateMatrixWorld","update","samples","render","autoClear","material","map","target","texture","innerText","floor","async","document","getElementById","WebGLRenderer","antialias","toneMapping","ACESFilmicToneMapping","outputEncoding","sRGBEncoding","setClearColor","body","appendChild","domElement","$4CEV9","PhysicalCamera","position","set","$5Rd1x","OrbitControls","y","Scene","backgroundBlurriness","PathTracingRenderer","PhysicalPathTracingMaterial","filterGlossyFactor","backgroundBlur","tiles","camera","$RPVlj","FullScreenQuad","MeshBasicMaterial","blending","CustomBlending","addEventListener","envMapPromise","$891vQ","RGBELoader","setDataType","FloatType","loadAsync","then","mapping","EquirectangularReflectionMapping","background","environment","envMapInfo","updateFrom","generator","$cVdfP","PathTracingSceneWorker","gltfPromise","$7lx9d","GLTFLoader","gltf","generate","scene","result","add","bvh","textures","materials","geometry","attributesArray","attributes","normal","tangent","uv","color","materialIndexAttribute","materialIndex","setTextures","dispose","Promise","all","remove","$dfcb81d2867cd445$var$init"],"version":3,"file":"basic.004d49e7.js.map"}