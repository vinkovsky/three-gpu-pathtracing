var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},a={},n=e.parcelRequire5b70;null==n&&((n=function(e){if(e in t)return t[e].exports;if(e in a){var n=a[e];delete a[e];var i={id:e,exports:{}};return t[e]=i,n.call(i.exports,i,i.exports),i.exports}var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){a[e]=t},e.parcelRequire5b70=n);var i=n("ilwiq"),r=n("kp7Te"),o=n("891vQ"),s=n("7lx9d"),l=n("jiuw3"),d=function(){var e=0,t=document.createElement("div");function a(e){return t.appendChild(e.dom),e}function n(a){for(var n=0;n<t.children.length;n++)t.children[n].style.display=n===a?"block":"none";e=a}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(a){a.preventDefault(),n(++e%t.children.length)}),!1);var i=(performance||Date).now(),r=i,o=0,s=a(new d.Panel("FPS","#0ff","#002")),l=a(new d.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=a(new d.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:t,addPanel:a,showPanel:n,begin:function(){i=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(l.update(e-i,200),e>=r+1e3&&(s.update(1e3*o/(e-r),100),r=e,o=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:t,setMode:n}};d.Panel=function(e,t,a){var n=1/0,i=0,r=Math.round,o=r(window.devicePixelRatio||1),s=80*o,l=48*o,d=3*o,c=2*o,m=3*o,p=15*o,u=74*o,g=30*o,h=document.createElement("canvas");h.width=s,h.height=l,h.style.cssText="width:80px;height:48px";var f=h.getContext("2d");return f.font="bold "+9*o+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=a,f.fillRect(0,0,s,l),f.fillStyle=t,f.fillText(e,d,c),f.fillRect(m,p,u,g),f.fillStyle=a,f.globalAlpha=.9,f.fillRect(m,p,u,g),{dom:h,update:function(l,y){n=Math.min(n,l),i=Math.max(i,l),f.fillStyle=a,f.globalAlpha=1,f.fillRect(0,0,s,p),f.fillStyle=t,f.fillText(r(l)+" "+e+" ("+r(n)+"-"+r(i)+")",d,c),f.drawImage(h,m+o,p,u-o,g,m,p,u-o,g),f.fillRect(m+u-o,p,o,g),f.fillStyle=a,f.globalAlpha=.9,f.fillRect(m+u-o,p,o,r((1-l/y)*g))}}};var c=d,m=n("cVdfP"),p=n("4CEV9"),u=n("RPVlj"),g=n("5Rd1x"),h=n("7ePFa"),f=n("kkvoh");const y="https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/config/",b=new URLSearchParams(window.location.search),w=parseInt(b.get("samples"))||-1,v="true"===b.get("hideUI"),x=parseInt(b.get("tiles"))||2,M={environmentIntensity:1,multipleImportanceSampling:!0,acesToneMapping:!0,tilesX:x,tilesY:x,samplesPerFrame:1,scale:parseInt(b.get("scale"))||1,model:"",checkerboardTransparency:!0,enable:!0,bounces:10,transmissiveBounces:10,pause:!1,displayImage:!1,imageMode:"overlay",imageOpacity:1,imageType:"dspbr-pt"};let S,T,F,E,k,C,R,I,P,A,L,B,D,O,j,U=!1,G=0;function N(){if(requestAnimationFrame(N),!(L.samples>=w&&-1!==w||(R.update(),k.style.display=M.displayImage?"inline-block":"none",k.style.opacity="side-by-side"===M.imageMode?1:M.imageOpacity,k.style.position="side-by-side"===M.imageMode?"initial":"absolute",k.style.width=P.domElement.style.width,k.style.height=P.domElement.style.height,U))){if((L.samples<1||!M.enable)&&P.render(O,A),M.enable&&0===G){const e=Math.floor(L.samples);if(F.innerText=`samples: ${e}`,L.material.materials.updateFrom(I.materials,I.textures),L.material.filterGlossyFactor=.5,L.material.bounces=M.bounces,L.material.transmissiveBounces=M.transmissiveBounces,L.material.physicalCamera.updateFrom(A),L.material.environmentIntensity=M.environmentIntensity,A.updateMatrixWorld(),!M.pause||L.samples<1)for(let e=0,t=M.samplesPerFrame;e<t;e++)L.update();P.autoClear=!1,B.render(P),P.autoClear=!0}else G>0&&G--;L.samples>=w&&-1!==w&&requestAnimationFrame((()=>{window.dispatchEvent(new Event("render-complete"))})),F.innerText=`Samples: ${Math.floor(L.samples)}`}}function z(){M.tilesX*M.tilesY!=1&&(G=1),L.reset()}async function q(){let e,t;C&&(E.classList.remove("checkerboard"),C.destroy(),C=null);const a=new i.LoadingManager,n=j[M.model];window.location.hash=M.model;let{orbit:d={},target:c={},dimensions:u={}}=n;const{verticalFoV:g=45,renderSkybox:b=!1,lighting:w="../../../shared-assets/environments/lightroom_14b.hdr"}=n;d=Object.assign({},{theta:0,phi:90,radius:1},d),c=Object.assign({},{x:0,y:0,z:0},c),u=Object.assign({},{width:768,height:768},u),d.radius=Math.max(d.radius,1e-5),U=!0,E.style.display="none",F.innerText="--",S.innerText="--",T.innerText="Loading",T.style.visibility="visible",V(),O.traverse((e=>{if(e.material){const t=e.material;for(const e in t)t[e]&&t[e].isTexture&&t[e].dispose()}})),I&&O.remove(I.scene);let x=new URL(n.model,y).toString();x=x.replace(/.*?glTF-Sample-Models/,"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master"),a.onLoad=async()=>{await f.ready;(new p.MaterialReducer).process(e);const a=[];e.traverse((e=>{e.isLight&&e.target&&a.push(e.target),e.geometry&&(e.geometry.hasAttribute("normal")||e.geometry.computeVertexNormals(),e.geometry.attributes.tangent||(e.geometry.hasAttribute("uv")?(h.computeMikkTSpaceTangents(e.geometry,f),e.material=e.material.clone(),e.material.normalScale&&(e.material.normalScale.y*=-1),e.material.clearcoatNormalScale&&(e.material.clearcoatNormalScale.y*=-1)):e.geometry.setAttribute("tangent",new i.BufferAttribute(new Float32Array(4*e.geometry.attributes.position.count),4,!1))))})),a.forEach((e=>{e.removeFromParent()}));const r=new i.Group;r.position.set(-c.x,-c.y,-c.z),r.add(e),e=r,e.updateMatrixWorld(!0);const o=new m.PathTracingSceneWorker,s=await o.generate(e,{onProgress:e=>{const t=Math.floor(100*e);T.innerText=`Building BVH : ${t}%`}});I=s,O.add(I.scene);const{bvh:y,textures:w,materials:x,lights:F}=s,k=y.geometry,R=L.material;R.bvh.updateFrom(y),R.attributesArray.updateFrom(k.attributes.normal,k.attributes.tangent,k.attributes.uv,k.attributes.color),R.materialIndexAttribute.updateFrom(k.attributes.materialIndex),R.textures.setTextures(P,2048,2048,w),R.materials.updateFrom(x,w),R.envMapInfo.updateFrom(t),R.lights.updateFrom(F),o.dispose(),T.style.visibility="hidden",S.innerHTML=n.credit||"",S.style.visibility=n.credit?"visible":"hidden",function(){if(v)return;C&&C.destroy(),C=new l.GUI,C.add(M,"model",Object.keys(j)).onChange(q);const e=C.addFolder("path tracing");e.add(M,"enable"),e.add(M,"pause"),e.add(M,"scale",0,1).onChange((e=>{const t=window.devicePixelRatio;let{dimensions:a={}}=j[M.model];a=Object.assign({},{width:768,height:768},a);const{width:n,height:i}=a;L.setSize(n*t*e,i*t*e),L.reset()})),e.add(M,"multipleImportanceSampling").onChange((e=>{L.material.setDefine("FEATURE_MIS",Number(e)),L.reset()})),e.add(M,"acesToneMapping").onChange((e=>{P.toneMapping=e?i.ACESFilmicToneMapping:i.NoToneMapping})),e.add(M,"bounces",1,20,1).onChange((()=>{L.reset()})),e.add(M,"transmissiveBounces",1,20,1).onChange((()=>{L.reset()})),e.add(M,"environmentIntensity",0,5).onChange((()=>{L.reset()}));const t=C.addFolder("comparison");t.add(M,"displayImage"),t.add(M,"imageMode",["overlay","side-by-side"]),t.add(M,"imageType",["dspbr-pt","filament","babylon","gltf-sample-viewer","model-viewer","rhodonite","stellar"]).onChange(V),t.add(M,"imageOpacity",0,1);const a=C.addFolder("resolution");a.add(M,"samplesPerFrame",1,10,1),a.add(M,"tilesX",1,10,1).onChange((e=>{L.tiles.x=e})),a.add(M,"tilesY",1,10,1).onChange((e=>{L.tiles.y=e})),a.open(),C.addFolder("background").add(M,"checkerboardTransparency").onChange((e=>{e?E.classList.add("checkerboard"):E.classList.remove("checkerboard")}))}(),k.computeBoundingSphere();const B=Math.max(d.radius,k.boundingSphere.radius);A.near=2*B/1e3,A.far=2*B,A.updateProjectionMatrix(),A.position.setFromSphericalCoords(d.radius,i.MathUtils.DEG2RAD*d.phi,i.MathUtils.DEG2RAD*d.theta);const G=window.devicePixelRatio,{width:N,height:z}=u;P.setSize(N,z),P.setPixelRatio(G),L.setSize(N*G*M.scale,z*G*M.scale),A.aspect=N/z,A.fov=g,A.updateProjectionMatrix(),D.update(),O.updateMatrixWorld(),A.updateMatrixWorld(),t.mapping=i.EquirectangularReflectionMapping,O.environment=t,b?(O.background=t,L.material.backgroundAlpha=1):(P.setClearAlpha(0),O.background=null,L.material.backgroundAlpha=0),L.reset(),E.style.display="flex",U=!1,M.checkerboardTransparency&&E.classList.add("checkerboard")};const k=new URL(w,y).toString();new o.RGBELoader(a).load(k,(e=>{t=e})),new s.GLTFLoader(a).setMeshoptDecoder(r.MeshoptDecoder).load(x,(t=>{e=t.scene}),(e=>{if(0!==e.total&&e.total>=e.loaded){const t=Math.floor(100*e.loaded/e.total);T.innerText=`Loading : ${t}%`}}))}function V(){k.src=`https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/goldens/${M.model}/${M.imageType}-golden.png`}!async function(){S=document.getElementById("credits"),T=document.getElementById("loading"),F=document.getElementById("samples"),E=document.getElementById("container"),k=document.querySelector("img"),v&&(E.style.background="transparent",document.body.style.background="transparent");P=new i.WebGLRenderer({antialias:!0}),P.outputEncoding=i.sRGBEncoding,P.toneMapping=i.ACESFilmicToneMapping,P.physicallyCorrectLights=!0,E.appendChild(P.domElement),O=new i.Scene;const e=window.innerWidth/window.innerHeight;A=new i.PerspectiveCamera(60,e,.01,500),A.position.set(-1,.25,1),L=new p.PathTracingRenderer(P),L.camera=A,L.alpha=!0,L.material=new p.PhysicalPathTracingMaterial,L.tiles.set(M.tiles,M.tiles),L.material.setDefine("FEATURE_MIS",Number(M.multipleImportanceSampling)),L.tiles.set(M.tilesX,M.tilesY),B=new u.FullScreenQuad(new i.MeshBasicMaterial({map:L.target.texture,blending:i.CustomBlending})),D=new g.OrbitControls(A,E),D.addEventListener("change",z),R=new c,v?(S.remove(),F.remove()):E.appendChild(R.dom);const{scenarios:t}=await(await fetch("https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/config.json")).json();j={},t.forEach((e=>{j[e.name]=e}));let a=t[0].name;if(window.location.hash){const e=window.location.hash.substring(1).replaceAll("%20"," ");e in j&&(a=e)}M.model=a,q(),N()}();
//# sourceMappingURL=viewerTest.daf0f9c0.js.map
