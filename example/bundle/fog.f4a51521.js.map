{"mappings":"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","sources":["example/fog.js"],"sourcesContent":["import * as THREE from 'three';\nimport { FullScreenQuad } from 'three/examples/jsm/postprocessing/Pass.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { PathTracingRenderer, PhysicalPathTracingMaterial, PhysicalCamera, PhysicalSpotLight, FogVolumeMaterial } from '../src/index.js';\nimport { PathTracingSceneWorker } from '../src/workers/PathTracingSceneWorker.js';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\nimport { BoxGeometry, CylinderGeometry, Group, Mesh, MeshStandardMaterial } from 'three';\n\nlet renderer, controls, sceneInfo, ptRenderer, blitQuad;\nlet perspectiveCamera, scene, fogMaterial, spotLight;\nlet samplesEl;\n\nconst params = {\n\n\tenable: true,\n\tpause: false,\n\tmis: true,\n\ttiles: 2,\n\tresolutionScale: 1 / window.devicePixelRatio,\n\n\tcolor: '#eeeeee',\n\tfog: true,\n\tdensity: 0.01,\n\tlightIntensity: 500,\n\tlightColor: '#ffffff',\n\n\tbounces: 10,\n\n};\n\ninit();\n\nasync function init() {\n\n\trenderer = new THREE.WebGLRenderer( { antialias: true } );\n\trenderer.toneMapping = THREE.ACESFilmicToneMapping;\n\trenderer.outputEncoding = THREE.sRGBEncoding;\n\trenderer.setClearColor( 0, 0 );\n\tdocument.body.appendChild( renderer.domElement );\n\n\tconst aspect = window.innerWidth / window.innerHeight;\n\tperspectiveCamera = new PhysicalCamera( 75, aspect, 0.025, 500 );\n\tperspectiveCamera.position.set( 0, 1, 6 );\n\n\tptRenderer = new PathTracingRenderer( renderer );\n\tptRenderer.alpha = true;\n\tptRenderer.material = new PhysicalPathTracingMaterial();\n\tptRenderer.tiles.set( params.tiles, params.tiles );\n\tptRenderer.camera = perspectiveCamera;\n\n\tblitQuad = new FullScreenQuad( new THREE.MeshBasicMaterial( {\n\t\tmap: ptRenderer.target.texture,\n\t\tblending: THREE.CustomBlending,\n\t\tpremultipliedAlpha: renderer.getContextAttributes().premultipliedAlpha,\n\t} ) );\n\n\tcontrols = new OrbitControls( perspectiveCamera, renderer.domElement );\n\tcontrols.addEventListener( 'change', () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\n\tscene = new THREE.Scene();\n\n\tsamplesEl = document.getElementById( 'samples' );\n\tfogMaterial = new FogVolumeMaterial();\n\n\tconst generator = new PathTracingSceneWorker();\n\tconst envMat = new MeshStandardMaterial( { color: 0x999999, roughness: 1, metalness: 0 } );\n\tconst fogMesh = new Mesh( new BoxGeometry( 8, 4.05, 8 ), fogMaterial );\n\tconst floor = new Mesh( new CylinderGeometry( 5, 5, 0.1, 40 ), envMat );\n\tfloor.position.y = - 1.1;\n\n\tspotLight = new PhysicalSpotLight();\n\tspotLight.position.set( 0, 1, 0 ).multiplyScalar( 3 );\n\tspotLight.angle = Math.PI / 4.5;\n\tspotLight.decay = 2;\n\tspotLight.penumbra = 0.15;\n\tspotLight.distance = 0.0;\n\tspotLight.intensity = 50.0;\n\tspotLight.radius = 0.05;\n\n\tconst lightGroup = new Group();\n\tlightGroup.add( spotLight );\n\n\tconst TOTAL_SLATS = 10;\n\tconst WIDTH = 2.0;\n\tconst slat = new Mesh( new BoxGeometry( 0.1, 0.1, 2 ), envMat );\n\tfor ( let i = 0; i < TOTAL_SLATS; i ++ ) {\n\n\t\tconst s = slat.clone();\n\t\ts.position.x = - WIDTH * 0.5 + WIDTH * i / ( TOTAL_SLATS - 1 );\n\t\ts.position.y = 2;\n\t\tlightGroup.add( s );\n\n\t}\n\n\tconst group = new Group();\n\tgroup.add( fogMesh, floor, lightGroup );\n\n\tgroup.updateMatrixWorld();\n\tsceneInfo = await generator.generate( group );\n\tscene.add( sceneInfo.scene );\n\n\tconst { bvh, textures, materials } = sceneInfo;\n\tconst geometry = bvh.geometry;\n\tptRenderer.material.environmentIntensity = 0.0;\n\tptRenderer.material.bvh.updateFrom( bvh );\n\tptRenderer.material.attributesArray.updateFrom(\n\t\tgeometry.attributes.normal,\n\t\tgeometry.attributes.tangent,\n\t\tgeometry.attributes.uv,\n\t\tgeometry.attributes.color,\n\t);\n\tptRenderer.material.materialIndexAttribute.updateFrom( geometry.attributes.materialIndex );\n\tptRenderer.material.textures.setTextures( renderer, 2048, 2048, textures );\n\tptRenderer.material.materials.updateFrom( materials, textures );\n\tptRenderer.material.lights.updateFrom( sceneInfo.lights );\n\n\tgenerator.dispose();\n\n\tonResize();\n\n\twindow.addEventListener( 'resize', onResize );\n\n\tconst gui = new GUI();\n\tconst ptFolder = gui.addFolder( 'Path Tracing' );\n\tptFolder.add( params, 'enable' );\n\tptFolder.add( params, 'pause' );\n\tptFolder.add( params, 'bounces', 1, 20, 1 ).onChange( () => ptRenderer.reset() );\n\tptFolder.add( params, 'mis' ).onChange( v => {\n\n\t\tptRenderer.material.setDefine( 'FEATURE_MIS', Number( v ) );\n\t\tptRenderer.reset();\n\n\t} );\n\tptFolder.add( params, 'tiles', 1, 4, 1 ).onChange( value => {\n\n\t\tptRenderer.tiles.set( value, value );\n\n\t} );\n\tptFolder.add( params, 'resolutionScale', 0.1, 1 ).onChange( () => {\n\n\t\tonResize();\n\n\t} );\n\n\tconst fogFolder = gui.addFolder( 'fog' );\n\tfogFolder.addColor( params, 'color' ).onChange( reset );\n\tfogFolder.add( params, 'density', 0, 1 ).onChange( reset );\n\n\tconst lightFolder = gui.addFolder( 'light' );\n\tlightFolder.add( params, 'lightIntensity', 0, 1000 ).onChange( reset );\n\tlightFolder.addColor( params, 'lightColor' ).onChange( reset );\n\n\tanimate();\n\n}\n\nfunction reset() {\n\n\tptRenderer.reset();\n\n}\n\nfunction onResize() {\n\n\tconst w = window.innerWidth;\n\tconst h = window.innerHeight;\n\tconst scale = params.resolutionScale;\n\tconst dpr = window.devicePixelRatio;\n\n\tptRenderer.setSize( w * scale * dpr, h * scale * dpr );\n\tptRenderer.reset();\n\n\trenderer.setSize( w, h );\n\trenderer.setPixelRatio( window.devicePixelRatio * scale );\n\n\tconst aspect = w / h;\n\tperspectiveCamera.aspect = aspect;\n\tperspectiveCamera.updateProjectionMatrix();\n\n\tptRenderer.reset();\n\n}\n\nfunction animate() {\n\n\trequestAnimationFrame( animate );\n\n\tfogMaterial.color.set( params.color ).convertSRGBToLinear();\n\tfogMaterial.density = params.density;\n\n\tspotLight.intensity = params.lightIntensity;\n\tspotLight.color.set( params.lightColor );\n\n\tptRenderer.material.materials.updateFrom( sceneInfo.materials, sceneInfo.textures );\n\tptRenderer.material.lights.updateFrom( sceneInfo.lights );\n\tperspectiveCamera.updateMatrixWorld();\n\n\tptRenderer.material.bounces = params.bounces;\n\n\tif ( ptRenderer.samples < 1 || ! params.enable ) {\n\n\t\trenderer.render( scene, perspectiveCamera );\n\n\t}\n\n\tif ( params.enable ) {\n\n\t\tif ( ! params.pause || ptRenderer.samples < 1 ) {\n\n\t\t\tptRenderer.update();\n\n\t\t}\n\n\t\trenderer.autoClear = false;\n\t\tblitQuad.material.map = ptRenderer.target.texture;\n\t\tblitQuad.render( renderer );\n\t\trenderer.autoClear = true;\n\n\t}\n\n\tsamplesEl.innerText = `Samples: ${ Math.floor( ptRenderer.samples ) }`;\n\n}\n\n\n\n\n"],"names":["$ilwiq","parcelRequire","$afdbfb1b28c84b51$var$renderer","$afdbfb1b28c84b51$var$controls","$afdbfb1b28c84b51$var$sceneInfo","$afdbfb1b28c84b51$var$ptRenderer","$afdbfb1b28c84b51$var$blitQuad","$afdbfb1b28c84b51$var$perspectiveCamera","$afdbfb1b28c84b51$var$scene","$afdbfb1b28c84b51$var$fogMaterial","$afdbfb1b28c84b51$var$spotLight","$afdbfb1b28c84b51$var$samplesEl","$afdbfb1b28c84b51$var$params","enable","pause","mis","tiles","resolutionScale","window","devicePixelRatio","color","fog","density","lightIntensity","lightColor","bounces","$afdbfb1b28c84b51$var$reset","reset","$afdbfb1b28c84b51$var$onResize","w","innerWidth","h","innerHeight","scale","dpr","setSize","setPixelRatio","aspect","updateProjectionMatrix","$afdbfb1b28c84b51$var$animate","requestAnimationFrame","set","convertSRGBToLinear","intensity","material","materials","updateFrom","textures","lights","updateMatrixWorld","samples","render","update","autoClear","map","target","texture","innerText","Math","floor","async","WebGLRenderer","antialias","toneMapping","ACESFilmicToneMapping","outputEncoding","sRGBEncoding","setClearColor","document","body","appendChild","domElement","$4CEV9","PhysicalCamera","position","PathTracingRenderer","alpha","PhysicalPathTracingMaterial","camera","$RPVlj","FullScreenQuad","MeshBasicMaterial","blending","CustomBlending","premultipliedAlpha","getContextAttributes","$5Rd1x","OrbitControls","addEventListener","Scene","getElementById","FogVolumeMaterial","generator","$cVdfP","PathTracingSceneWorker","envMat","MeshStandardMaterial","roughness","metalness","fogMesh","Mesh","BoxGeometry","CylinderGeometry","y","PhysicalSpotLight","multiplyScalar","angle","PI","decay","penumbra","distance","radius","lightGroup","Group","add","slat","i","s","clone","x","group","generate","scene","bvh","geometry","environmentIntensity","attributesArray","attributes","normal","tangent","uv","materialIndexAttribute","materialIndex","setTextures","dispose","gui","$jiuw3","GUI","ptFolder","addFolder","onChange","v","setDefine","Number","value","fogFolder","addColor","lightFolder","$afdbfb1b28c84b51$var$init"],"version":3,"file":"fog.f4a51521.js.map"}