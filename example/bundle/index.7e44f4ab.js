var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},o={},a=e.parcelRequire5b70;null==a&&((a=function(e){if(e in t)return t[e].exports;if(e in o){var a=o[e];delete o[e];var n={id:e,exports:{}};return t[e]=n,a.call(n.exports,n,n.exports),n.exports}var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){o[e]=t},e.parcelRequire5b70=a);var n=a("ilwiq"),r=a("kp7Te"),s=a("891vQ"),i=a("7lx9d"),d=a("cpS3d"),l=a("9hfHi"),c=a("jiuw3"),h=function(){var e=0,t=document.createElement("div");function o(e){return t.appendChild(e.dom),e}function a(o){for(var a=0;a<t.children.length;a++)t.children[a].style.display=a===o?"block":"none";e=o}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(o){o.preventDefault(),a(++e%t.children.length)}),!1);var n=(performance||Date).now(),r=n,s=0,i=o(new h.Panel("FPS","#0ff","#002")),d=o(new h.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=o(new h.Panel("MB","#f08","#201"));return a(0),{REVISION:16,dom:t,addPanel:o,showPanel:a,begin:function(){n=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(d.update(e-n,200),e>=r+1e3&&(i.update(1e3*s/(e-r),100),r=e,s=0,l)){var t=performance.memory;l.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){n=this.end()},domElement:t,setMode:a}};h.Panel=function(e,t,o){var a=1/0,n=0,r=Math.round,s=r(window.devicePixelRatio||1),i=80*s,d=48*s,l=3*s,c=2*s,h=3*s,m=15*s,u=74*s,p=30*s,g=document.createElement("canvas");g.width=i,g.height=d,g.style.cssText="width:80px;height:48px";var b=g.getContext("2d");return b.font="bold "+9*s+"px Helvetica,Arial,sans-serif",b.textBaseline="top",b.fillStyle=o,b.fillRect(0,0,i,d),b.fillStyle=t,b.fillText(e,l,c),b.fillRect(h,m,u,p),b.fillStyle=o,b.globalAlpha=.9,b.fillRect(h,m,u,p),{dom:g,update:function(d,f){a=Math.min(a,d),n=Math.max(n,d),b.fillStyle=o,b.globalAlpha=1,b.fillRect(0,0,i,m),b.fillStyle=t,b.fillText(r(d)+" "+e+" ("+r(a)+"-"+r(n)+")",l,c),b.drawImage(g,h+s,m,u-s,p,h,m,u-s,p),b.fillRect(h+u-s,m,s,p),b.fillStyle=o,b.globalAlpha=.9,b.fillRect(h+u-s,m,s,r((1-d/f)*p))}}};var m=h,u=a("1EdOY"),p=a("cVdfP"),g=a("4CEV9"),b=a("RPVlj"),f=a("5Rd1x");const w={"Royal Esplanade":"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/royal_esplanade_1k.hdr","Moonless Golf":"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/moonless_golf_1k.hdr",Overpass:"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/pedestrian_overpass_1k.hdr","Venice Sunset":"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/venice_sunset_1k.hdr","Small Studio":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/studio_small_05_1k.hdr","Pfalzer Forest":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/phalzer_forest_01_1k.hdr","Leadenhall Market":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/leadenhall_market_1k.hdr",Kloppenheim:"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/kloppenheim_05_1k.hdr","Hilly Terrain":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/hilly_terrain_01_1k.hdr","Circus Arena":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/circus_arena_1k.hdr","Chinese Garden":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/chinese_garden_1k.hdr",Autoshop:"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/autoshop_01_1k.hdr","Measuring Lab":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/vintage_measuring_lab_2k.hdr","Whale Skeleton":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/whale_skeleton_2k.hdr","Hall of Mammals":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/hall_of_mammals_2k.hdr","Drachenfels Cellar":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/drachenfels_cellar_2k.hdr","Adams Place Bridge":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/adams_place_bridge_2k.hdr","Sepulchral Chapel Rotunda":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/sepulchral_chapel_rotunda_2k.hdr","Peppermint Powerplant":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/peppermint_powerplant_2k.hdr","Noon Grass":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/noon_grass_2k.hdr","Narrow Moonlit Road":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/narrow_moonlit_road_2k.hdr","St Peters Square Night":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/st_peters_square_night_2k.hdr","Brown Photostudio 01":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/brown_photostudio_01_2k.hdr","Rainforest Trail":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/rainforest_trail_2k.hdr","Brown Photostudio 07":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/brown_photostudio_07_2k.hdr","Brown Photostudio 06":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/brown_photostudio_06_2k.hdr","Dancing Hall":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/dancing_hall_2k.hdr","Aristea Wreck Puresky":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/aristea_wreck_puresky_2k.hdr","Modern Buildings 2":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/modern_buildings_2_2k.hdr","Thatch Chapel":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/thatch_chapel_2k.hdr",Vestibule:"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/vestibule_2k.hdr","Blocky Photo Studio":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/blocky_photo_studio_1k.hdr","Christmas Photo Studio 07":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/christmas_photo_studio_07_2k.hdr","Aerodynamics Workshop":"https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/aerodynamics_workshop_1k.hdr"},k=window.MODEL_LIST||{};let y=Object.keys(k)[0];if(window.location.hash){const e=window.location.hash.substring(1).replaceAll("%20"," ");e in k&&(y=e)}const _={multipleImportanceSampling:!0,acesToneMapping:!0,resolutionScale:1/window.devicePixelRatio,tilesX:2,tilesY:2,samplesPerFrame:1,model:y,envMap:w["Aristea Wreck Puresky"],gradientTop:"#bfd8ff",gradientBottom:"#ffffff",environmentIntensity:1,environmentBlur:0,environmentRotation:0,cameraProjection:"Perspective",backgroundType:"Gradient",bgGradientTop:"#111111",bgGradientBottom:"#000000",backgroundAlpha:1,checkerboardTransparency:!0,enable:!0,bounces:5,filterGlossyFactor:.5,pause:!1,floorColor:"#111111",floorOpacity:1,floorRoughness:.2,floorMetalness:.2};let v,M,x,C,T,P,S,j,R,F,E,B,L,G,A,I,O,D,H=!1,q=0;function W(){if(requestAnimationFrame(W),P.update(),!H){if(C.material.color.set(_.floorColor),C.material.roughness=_.floorRoughness,C.material.metalness=_.floorMetalness,C.material.opacity=_.floorOpacity,(B.samples<1||!_.enable)&&j.render(A,E),_.enable&&0===q){const e=Math.floor(B.samples);if(x.innerText=`samples: ${e}`,B.material.materials.updateFrom(S.materials,S.textures),B.material.filterGlossyFactor=_.filterGlossyFactor,B.material.environmentIntensity=_.environmentIntensity,B.material.bounces=_.bounces,B.material.physicalCamera.updateFrom(E),E.updateMatrixWorld(),!_.pause||B.samples<1)for(let e=0,t=_.samplesPerFrame;e<t;e++)B.update();j.autoClear=!1,L.render(j),j.autoClear=!0}else q>0&&q--;x.innerText=`Samples: ${Math.floor(B.samples)}`}}function N(){_.tilesX*_.tilesY!=1&&(q=1),B.reset()}function V(){const e=window.innerWidth,t=window.innerHeight,o=_.resolutionScale,a=window.devicePixelRatio;B.setSize(e*o*a,t*o*a),B.reset(),j.setSize(e,t),j.setPixelRatio(window.devicePixelRatio*o);const n=e/t;F.aspect=n,F.updateProjectionMatrix();const r=2/n;R.top=r/2,R.bottom=r/-2,R.updateProjectionMatrix()}function z(){(new s.RGBELoader).setDataType(n.FloatType).load(_.envMap,(e=>{A.environmentMap&&(A.environment.dispose(),I.dispose()),I=e,$(),B.reset()}))}function $(){const e=O.generate(I,_.environmentBlur);B.material.envMapInfo.updateFrom(e),A.environment=e,"Gradient"!==_.backgroundType&&(A.background=e)}function U(e){"Perspective"===e?(E&&F.position.copy(E.position),E=F):(E&&R.position.copy(E.position),E=R),G.object=E,B.camera=E,G.update(),N()}async function Y(){let e;T&&(document.body.classList.remove("checkerboard"),T.destroy(),T=null);const t=new n.LoadingManager,o=k[_.model];H=!0,j.domElement.style.visibility="hidden",x.innerText="--",v.innerText="--",M.innerText="Loading",M.style.visibility="visible",A.traverse((e=>{if(e.material){const t=e.material;for(const e in t)t[e]&&t[e].isTexture&&t[e].dispose()}})),S&&A.remove(S.scene);const a=async()=>{o.removeEmission&&e.traverse((e=>{e.material&&(e.material.emissiveMap=null,e.material.emissiveIntensity=0)})),o.opacityToTransmission&&function(e,t){e.traverse((e=>{if(e.material){const o=e.material;if(o.opacity<.65&&o.opacity>.2){const a=new n.MeshPhysicalMaterial;for(const e in o)if(e in o){if(null===o[e])continue;o[e].isTexture?a[e]=o[e]:o[e].copy&&o[e].constructor===a[e].constructor?a[e].copy(o[e]):"number"==typeof o[e]&&(a[e]=o[e])}a.opacity=1,a.transmission=1,a.ior=t;const r={};a.color.getHSL(r),r.l=Math.max(r.l,.35),a.color.setHSL(r.h,r.s,r.l),e.material=a}}}))}(e,o.ior||1.5),e.traverse((e=>{e.material&&(e.material.thickness=1)})),o.postProcess&&o.postProcess(e),o.rotation&&e.rotation.set(...o.rotation);const t=new n.Box3;t.setFromObject(e),e.position.addScaledVector(t.min,-.5).addScaledVector(t.max,-.5);const a=new n.Sphere;t.getBoundingSphere(a),e.scale.setScalar(1/a.radius),e.position.multiplyScalar(1/a.radius),t.setFromObject(e),e.updateMatrixWorld();const r=new n.Group;C.position.y=t.min.y,r.add(e,C);(new g.MaterialReducer).process(r);const s=new p.PathTracingSceneWorker,i=await s.generate(r,{onProgress:e=>{const t=Math.floor(100*e);M.innerText=`Building BVH : ${t}%`}});S=i,A.add(S.scene);const{bvh:d,textures:l,materials:h,lights:m}=i,u=d.geometry,b=B.material;b.bvh.updateFrom(d),b.attributesArray.updateFrom(u.attributes.normal,u.attributes.tangent,u.attributes.uv,u.attributes.color),b.materialIndexAttribute.updateFrom(u.attributes.materialIndex),b.textures.setTextures(j,2048,2048,l),b.materials.updateFrom(h,l),b.lights.updateFrom(m),s.dispose(),M.style.visibility="hidden",v.innerHTML=o.credit||"",v.style.visibility=o.credit?"visible":"hidden",_.bounces=o.bounces||5,_.floorColor=o.floorColor||"#111111",_.floorRoughness=o.floorRoughness||.2,_.floorMetalness=o.floorMetalness||.2,_.bgGradientTop=o.gradientTop||"#111111",_.bgGradientBottom=o.gradientBot||"#000000",D.topColor.set(_.bgGradientTop),D.bottomColor.set(_.bgGradientBottom),D.update(),function(){T&&T.destroy(),T=new c.GUI,T.add(_,"model",Object.keys(k)).onChange(Y);const e=T.addFolder("path tracing");e.add(_,"enable"),e.add(_,"pause"),e.add(_,"multipleImportanceSampling").onChange((e=>{B.material.setDefine("FEATURE_MIS",Number(e)),B.reset()})),e.add(_,"acesToneMapping").onChange((e=>{j.toneMapping=e?n.ACESFilmicToneMapping:n.NoToneMapping})),e.add(_,"bounces",1,20,1).onChange((()=>{B.reset()})),e.add(_,"filterGlossyFactor",0,1).onChange((()=>{B.reset()}));const t=T.addFolder("resolution");t.add(_,"resolutionScale",.1,1,.01).onChange((()=>{V()})),t.add(_,"samplesPerFrame",1,10,1),t.add(_,"tilesX",1,10,1).onChange((e=>{B.tiles.x=e})),t.add(_,"tilesY",1,10,1).onChange((e=>{B.tiles.y=e})),t.add(_,"cameraProjection",["Perspective","Orthographic"]).onChange((e=>{U(e)})),t.open();const o=T.addFolder("environment");o.add(_,"envMap",w).name("map").onChange(z),o.add(_,"environmentBlur",0,1).onChange((()=>{$(),B.reset()})).name("env map blur"),o.add(_,"environmentIntensity",0,10).onChange((()=>{B.reset()})).name("intensity"),o.add(_,"environmentRotation",0,2*Math.PI).onChange((e=>{B.material.environmentRotation.makeRotationY(e),B.reset()})),o.open();const a=T.addFolder("background");a.add(_,"backgroundType",["Environment","Gradient"]).onChange((e=>{"Gradient"===e?(A.background=D,B.material.backgroundMap=D):(A.background=A.environment,B.material.backgroundMap=null),B.reset()})),a.addColor(_,"bgGradientTop").onChange((e=>{D.topColor.set(e),D.update(),B.reset()})),a.addColor(_,"bgGradientBottom").onChange((e=>{D.bottomColor.set(e),D.update(),B.reset()})),a.add(_,"backgroundAlpha",0,1).onChange((e=>{B.material.backgroundAlpha=e,B.reset()})),a.add(_,"checkerboardTransparency").onChange((e=>{e?document.body.classList.add("checkerboard"):document.body.classList.remove("checkerboard")}));const r=T.addFolder("floor");r.addColor(_,"floorColor").onChange((()=>{B.reset()})),r.add(_,"floorRoughness",0,1).onChange((()=>{B.reset()})),r.add(_,"floorMetalness",0,1).onChange((()=>{B.reset()})),r.add(_,"floorOpacity",0,1).onChange((()=>{B.reset()})),r.close()}(),H=!1,j.domElement.style.visibility="visible",_.checkerboardTransparency&&document.body.classList.add("checkerboard"),B.reset()},s=o.url;if(/(gltf|glb)$/i.test(s))t.onLoad=a,new i.GLTFLoader(t).setMeshoptDecoder(r.MeshoptDecoder).load(s,(t=>{e=t.scene}),(e=>{if(0!==e.total&&e.total>=e.loaded){const t=Math.floor(100*e.loaded/e.total);M.innerText=`Loading : ${t}%`}}));else if(/mpd$/i.test(s)){let o=!1;t.onProgress=(e,t,a)=>{if(o)return;const n=Math.floor(100*t/a);M.innerText=`Loading : ${n}%`};const n=new d.LDrawLoader(t);await n.preloadMaterials("https://raw.githubusercontent.com/gkjohnson/ldraw-parts-library/master/colors/ldcfgalt.ldr"),n.setPartsLibraryPath("https://raw.githubusercontent.com/gkjohnson/ldraw-parts-library/master/complete/ldraw/").load(s,(t=>{e=l.LDrawUtils.mergeObject(t),e.rotation.set(Math.PI,0,0);const o=[];e.traverse((e=>{e.isLineSegments&&o.push(e),e.isMesh&&(e.material.roughness*=.25)})),o.forEach((e=>{e.parent.remove(e)})),a()}),void 0,(e=>{o=!0,M.innerText="Failed to load model. "+e.message}))}}!async function(){v=document.getElementById("credits"),M=document.getElementById("loading"),x=document.getElementById("samples"),j=new n.WebGLRenderer({antialias:!0}),j.outputEncoding=n.sRGBEncoding,j.toneMapping=n.ACESFilmicToneMapping,j.physicallyCorrectLights=!0,document.body.appendChild(j.domElement),A=new n.Scene;const e=window.innerWidth/window.innerHeight;F=new n.PerspectiveCamera(60,e,.025,500),F.position.set(-1,.25,1);const t=2/e;R=new n.OrthographicCamera(-1,1,t/2,t/-2,0,100),R.position.set(-1,.25,1),D=new g.GradientEquirectTexture,D.topColor.set(_.bgGradientTop),D.bottomColor.set(_.bgGradientBottom),D.update(),B=new g.PathTracingRenderer(j),B.alpha=!0,B.material=new g.PhysicalPathTracingMaterial,B.tiles.set(_.tiles,_.tiles),B.material.setDefine("FEATURE_MIS",Number(_.multipleImportanceSampling)),B.material.backgroundMap=D,B.material.transmissiveBounces=10,L=new b.FullScreenQuad(new n.MeshBasicMaterial({map:B.target.texture,blending:n.CustomBlending,premultipliedAlpha:j.getContextAttributes().premultipliedAlpha})),G=new f.OrbitControls(F,j.domElement),G.addEventListener("change",N),O=new g.BlurredEnvMapGenerator(j);const o=u.generateRadialFloorTexture(2048);C=new n.Mesh(new n.PlaneGeometry,new n.MeshStandardMaterial({map:o,transparent:!0,color:1118481,roughness:.1,metalness:0,side:n.DoubleSide})),C.scale.setScalar(5),C.rotation.x=-Math.PI/2,P=new m,document.body.appendChild(P.dom),A.background=D,B.tiles.set(_.tilesX,_.tilesY),U(_.cameraProjection),Y(),z(),V(),W(),window.addEventListener("resize",V)}();
//# sourceMappingURL=index.7e44f4ab.js.map
