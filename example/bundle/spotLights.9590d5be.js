var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},a={},t={},n=e.parcelRequire5b70;null==n&&((n=function(e){if(e in a)return a[e].exports;if(e in t){var n=t[e];delete t[e];var o={id:e,exports:{}};return a[e]=o,n.call(o.exports,o,o.exports),o.exports}var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,a){t[e]=a},e.parcelRequire5b70=n);var o=n("ilwiq"),r=n("RPVlj"),s=n("7lx9d"),i=n("5Rd1x"),d=n("4CEV9"),l=n("cVdfP"),c=n("891vQ"),m=n("jiuw3"),h=n("fUhpq");let u,g,p,w,b,f,y,C,M,S,v,x,F,P,T;const E=["https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/0646706b3d2d9658994fc4ad80681dec.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/06b4cfdc8805709e767b5e2e904be8ad.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/007cfb11e343e2f42e3b476be4ab684e.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/01dac7d6c646814dcda6780e7b7b4566.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/108b32f07d6d38a7a6528a6d307440df.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/1aec5958092c236d005093ca27ebe378.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/02a7562c650498ebb301153dbbf59207.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/1a936937a49c63374e6d4fbed9252b29.ies","https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/ies/00c6ce79e1d2cdf3a1fb491aaaa47ae0.ies"],I={floorMaterial:{color:"#555555",roughness:.05,metalness:.4},wallMaterial:{color:"#a06464",roughness:.4,metalness:.1},enabled:!0,multipleImportanceSampling:!0,environmentIntensity:.1,bounces:3,samplesPerFrame:1,resolutionScale:1/window.devicePixelRatio,filterGlossyFactor:.5,tiles:2,iesProfile:-1,showTransformControls:!1,showLightHelper:!1};function L(){const e=window.innerWidth,a=window.innerHeight,t=I.resolutionScale,n=window.devicePixelRatio;M.setSize(e*t*n,a*t*n),M.reset(),u.setSize(e,a),u.setPixelRatio(window.devicePixelRatio*t);const o=e/a;x.aspect=o,x.updateProjectionMatrix()}function j(){M.reset()}function k(){requestAnimationFrame(k);const e=v[0];e.color.set(I.floorMaterial.color).convertSRGBToLinear(),e.metalness=I.floorMaterial.metalness,e.roughness=I.floorMaterial.roughness;const a=v[1];if(a.color.set(I.wallMaterial.color).convertSRGBToLinear(),a.metalness=I.wallMaterial.metalness,a.roughness=I.wallMaterial.roughness,M.material.materials.updateFrom(C.materials,C.textures),M.material.filterGlossyFactor=I.filterGlossyFactor,M.material.environmentIntensity=I.environmentIntensity,M.material.bounces=I.bounces,M.material.physicalCamera.updateFrom(x),M.material.lights.updateFrom(b,P),x.updateMatrixWorld(),y.update(),(!I.enabled||M.samples<1)&&u.render(F,x),I.enabled){for(let e=0,a=I.samplesPerFrame;e<a;e++)M.update();u.autoClear=!1,S.material.map=M.target.texture,S.material.depthWrite=!1,S.render(u),p.children.forEach((e=>{e.visible=e instanceof o.SpotLightHelper?I.showLightHelper:I.showTransformControls,"enabled"in e&&(e.enabled=I.showTransformControls)})),u.render(p,x),u.autoClear=!0,T.innerText=`Samples: ${Math.floor(M.samples)}`}}window.innerWidth/window.innerHeight<.65&&(I.resolutionScale*=.5,I.tiles=2),async function(){u=new o.WebGLRenderer({antialias:!0}),u.toneMapping=o.ACESFilmicToneMapping,u.shadowMap.type=o.PCFSoftShadowMap,u.setClearColor(0,0),u.shadowMap.enabled=!0,u.physicallyCorrectLights=!0,document.body.appendChild(u.domElement);const e=window.innerWidth/window.innerHeight;x=new d.PhysicalCamera(75,e,.025,500),x.position.set(-2,4,8).multiplyScalar(.8),x.bokehSize=0,M=new d.PathTracingRenderer(u),M.material=new d.PhysicalPathTracingMaterial,M.material.backgroundBlur=.1,M.material.setDefine("FEATURE_MIS",Number(I.multipleImportanceSampling)),M.tiles.set(I.tiles,I.tiles),M.camera=x,S=new r.FullScreenQuad(new o.MeshBasicMaterial({map:M.target.texture,blending:o.CustomBlending})),g=new i.OrbitControls(x,u.domElement),g.target.y=1.5,g.update(),g.addEventListener("change",(()=>{M.reset()})),F=new o.Scene,p=new o.Scene,T=document.getElementById("samples");const a=(new c.RGBELoader).setDataType(o.FloatType).loadAsync("https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/royal_esplanade_1k.hdr").then((e=>(e.mapping=o.EquirectangularReflectionMapping,F.environment=e,F.background=e,e))),t=new l.PathTracingSceneWorker,n=(new s.GLTFLoader).loadAsync("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/steampunk-robot/scene.gltf").then((e=>{const a=new o.Group;e.scene.scale.setScalar(1),e.scene.updateMatrixWorld(),e.scene.traverse((e=>{e.castShadow=!0,e.receiveShadow=!0})),a.add(e.scene);const n=new o.Box3;n.setFromObject(e.scene);const r=new o.Mesh(new o.CylinderGeometry(8,8,.5,200),new o.MeshStandardMaterial({color:16777215,roughness:.5,metalness:.2}));r.geometry=r.geometry.toNonIndexed(),r.geometry.clearGroups(),r.position.y=n.min.y-.25,r.receiveShadow=!0,a.add(r);const s=new o.Mesh(new o.BoxGeometry(14,6,.5),new o.MeshStandardMaterial({color:16777215,roughness:0,metalness:1}));function i(e){const a=new h.TransformControls(x,u.domElement);a.addEventListener("objectChange",(()=>{M.reset()})),a.addEventListener("dragging-changed",(e=>{g.enabled=!e.value})),a.attach(e),p.add(a)}s.castShadow=!0,s.receiveShadow=!0,s.geometry=s.geometry.toNonIndexed(),s.geometry.clearGroups(),s.position.x=0,s.position.y=n.min.y+3,s.position.z=n.min.z-.5,a.add(s),b=[],f=[],w=new d.PhysicalSpotLight(16777215),w.position.set(0,7,4),w.angle=Math.PI/4.5,w.decay=0,w.penumbra=1,w.distance=0,w.intensity=50,w.radius=.5,w.shadow.mapSize.width=512,w.shadow.mapSize.height=512,w.shadow.camera.near=.1,w.shadow.camera.far=10,w.shadow.focus=1,w.castShadow=!0,a.add(w),f.push(w),b.push(w);const l=w.target;l.position.x=0,l.position.y=r.position.y+2,l.position.z=.05,l.updateMatrixWorld(),w.updateMatrixWorld(),a.add(l),y=new o.SpotLightHelper(w),p.add(y),i(w),i(l);const c=E.map((e=>(new d.IESLoader).loadAsync(e)));return v=[r.material,s.material],Promise.all([t.generate(a),Promise.all(c)])})).then((([e,a])=>{P=a,C=e,F.add(e.scene);const{bvh:n,textures:o,materials:r,lights:s}=e,i=n.geometry,d=M.material;d.bvh.updateFrom(n),d.attributesArray.updateFrom(i.attributes.normal,i.attributes.tangent,i.attributes.uv,i.attributes.color),d.materialIndexAttribute.updateFrom(i.attributes.materialIndex),d.textures.setTextures(u,2048,2048,o),d.materials.updateFrom(r,o),d.iesProfiles.updateFrom(u,P),d.lights.updateFrom(s,P),M.material.envMapInfo.updateFrom(F.environment),t.dispose()}));await Promise.all([n,a]),document.getElementById("loading").remove(),L(),window.addEventListener("resize",L);const R=new m.GUI;R.add(I,"enabled"),R.add(I,"showTransformControls"),R.add(I,"showLightHelper");const G=R.addFolder("Path Tracing");G.add(I,"multipleImportanceSampling").onChange((e=>{M.material.setDefine("FEATURE_MIS",Number(e)),M.reset()})),G.add(I,"tiles",1,4,1).onChange((e=>{M.tiles.set(e,e)})),G.add(I,"samplesPerFrame",1,10,1),G.add(I,"filterGlossyFactor",0,1).onChange((()=>{M.reset()})),G.add(I,"bounces",1,30,1).onChange((()=>{M.reset()})),G.add(I,"resolutionScale",.1,1).onChange((()=>{L()}));R.addFolder("Environment").add(I,"environmentIntensity",0,10).onChange((()=>{M.reset()}));const W=R.addFolder("Floor Material");W.addColor(I.floorMaterial,"color").onChange(j),W.add(I.floorMaterial,"roughness",0,1).onChange(j),W.add(I.floorMaterial,"metalness",0,1).onChange(j),W.close();const B=R.addFolder("Wall Material");B.addColor(I.wallMaterial,"color").onChange(j),B.add(I.wallMaterial,"roughness",0,1).onChange(j),B.add(I.wallMaterial,"metalness",0,1).onChange(j),B.close();const z=R.addFolder("Spot Light");z.addColor(w,"color").onChange(j),z.add(w,"intensity",0,200,.01).onChange(j),z.add(w,"radius",0,10).onChange(j),z.add(w,"decay",0,2).onChange(j),z.add(w,"distance",0,20).onChange(j),z.add(w,"angle",0,Math.PI/2).onChange(j),z.add(w,"penumbra",0,1).onChange(j),z.add(I,"iesProfile",-1,E.length-1,1).onChange((e=>{w.iesTexture=-1===e?null:P[e],j()})),k()}();
//# sourceMappingURL=spotLights.9590d5be.js.map
